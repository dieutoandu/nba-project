<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NBA_PROJ</title>
    <link rel="stylesheet" href="{{ url_for('static',filename='style.css')}}">
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.6.0/dist/echarts.min.js"></script>

</head>


<body>
    <h1 style="text-align: center;">NBA 數據</h1>


    <div id="main" style="width: 1000px;height:400px; margin: 0 auto;"></div>


    <form action="">

        <label for="team">球隊</label>
        <select name="team" id="team">
            <option value="all">全部</option>
            {% for team in teams %}
            <option value="{{team}}">{{team}}</option>
            {% endfor %}
        </select>


        <label for="">數據</label>
        <select name="columns" id="columns">
            <option value="all">全部</option>
            {% for col in columns[2:] %}
            <option value="{{col}}">{{col}}</option>
            {% endfor %}
        </select>

        
    </form>

    <div id="chart_data" data-labels='{{x_data | tojson | safe}}' data-values='{{y_data | tojson | safe}}'></div>



    <table border="1">
        <thead>
            <tr>
                {% for col in columns %}
                <th>{{col}}</th>
                {% endfor %}
            </tr>
        </thead>
        <tbody>
            {% for data in datas %}
            <tr>
                {% for da in data %}
                <td>{{da}}</td>
                {% endfor %}
            </tr>
            {% endfor %}
        </tbody>
    </table>
    

   


</body>
<script>
    const teamsEl = document.querySelector("#team");
    const tableBody = document.querySelector("tbody");

    const chardata= document.querySelector("#chart_data");
    const labels=JSON.parse(chardata.dataset.labels);
    const values=JSON.parse(chardata.dataset.values);
    var myChart = echarts.init(document.getElementById('main'));

      // 指定图表的配置项和数据
      var option = {
        title: {
          text: 'NBA 球隊數據'
        },
        tooltip: {},
        legend: {
          data: ['數值']
        },
        color: ['#ff7f0e'],
        xAxis: {
          data: labels
        },
        
        dataZoom:[{
            type:'slider',
            start:0,
            end:100
        }],
        yAxis: {},
        series: [
          {
            name: '數值',
            type: 'bar',
            data: values,
            itemStyle: {
                    color: '#1f77b4'  // 單獨指定 bar 顏色
                }
          }
        ]
      };

      // 使用刚指定的配置项和数据显示图表。
      myChart.setOption(option);









    teamsEl.addEventListener("change", () => {
        const selectedTeam = teamsEl.value;
        
        

        fetch(`/get_team_data_table?team=${selectedTeam}`)
            .then(response => response.json())
            .then(data => {
                console.log(data);
                
                tableBody.innerHTML = ""; // 清空原本的表格內容

                data.datas.forEach(row => {
                    const tr = document.createElement("tr");
                    row.forEach(cell => {
                        const td = document.createElement("td");
                        td.textContent = cell;
                        tr.appendChild(td);
                    });
                    tableBody.appendChild(tr);
                });
                
                
            });


    });



</script>
</html>